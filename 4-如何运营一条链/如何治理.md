# 治理文档

*免责声明：此文档正在进行中，机制可能会更改。*

本文档描述了治理模块的高级架构。治理模块允许绑定的 Atom 持有者以 1 个绑定的 Atom 对应 1 票的方式对提案进行投票。

## 设计概述

治理过程分为以下几个步骤：

- **提案提交**：通过存入押金将提案提交到区块链
- **投票**：一旦押金达到一定值（`MinDeposit`），提案确认并开始投票。绑定的 Atom 持有者可以发送 `TxGovVote` 交易对提案进行投票
- 如果提案涉及软件升级
  - **信号**：验证者开始发出他们准备切换到新版本的信号
  - **切换**：一旦超过 2/3 的验证者发出了准备切换的信号，他们的软件会自动切换到新版本

## 提案提交

### 提交提案的权利

任何 Atom 持有者，无论是否绑定，都可以通过发送 `TxProposal` 交易提交提案。提案一旦提交，将通过其唯一的 `proposalID` 进行识别。

### 提案过滤器（最低押金）

为了防止垃圾提案，提案必须伴随一定的 `deposit` 提交，押金金额需在 `0 < deposit < MinDeposit` 之间。
其他 Atom 持有者可以通过发送 `TxGovDeposit` 交易增加提案的押金。
一旦提案的押金达到 `MinDeposit`，它将进入投票期。

### 押金退款

在以下两种情况下，存入押金的 Atom 持有者可以取回押金：
- 如果提案被接受
- 如果提案的押金在超过 `mMxDepositPeriod`（初始值：2 个月）期间未达到 `MinDeposit`，则提案被视为关闭，无法再对其存入押金。

在这种情况下，存入押金的 Atom 持有者可以发送 `TxGovClaimDeposit` 交易取回其押金份额。

### 提案类型

在治理模块的初始版本中，有两种提案类型：
- `PlainTextProposal`：所有不涉及源代码修改的提案都属于此类型。例如，意见调查将使用 `PlainTextProposal` 类型的提案。
- `SoftwareUpgradeProposal`：如果被接受，验证者需根据提案更新他们的软件，并按照[软件升级](#software-upgrade)部分中描述的两步流程进行操作。软件升级路线图可以通过 `PlainTextProposals` 讨论和达成一致，但实际的软件升级必须通过 `SoftwareUpgradeProposals` 进行。

### 提案类别

有两类提案：
- `Regular`
- `Urgent`

这两类提案完全相同，除了 `Urgent` 提案在满足特定条件时可以更快被接受。更多信息请参见[阈值](#threshold)部分。

## 投票

### 参与者

*参与者*是有权投票的用户。在 Cosmos Hub 上，参与者是绑定的 Atom 持有者。未绑定的 Atom 持有者和其他用户无权参与治理，但可以提交和对提案存入押金。

### 投票期

一旦提案达到 `MinDeposit`，它立即进入 `Voting period`。我们将 `Voting period` 定义为从投票开始到投票结束的时间间隔。`Voting period` 应始终短于 `Unbonding period` 以防止重复投票。初始值为 2 周。

### 选项集

提案的选项集指的是参与者在投票时可以选择的一组选项。

初始选项集包括以下选项：
- `Yes`
- `No`
- `NoWithVeto`
- `Abstain`

`NoWithVeto` 计为 `No`，但也增加一票 `Veto`。`Abstain` 允许投票者表示他们不打算支持或反对提案，但接受投票结果。

*注意：对于紧急提案，UI 可能需要添加一个‘Not Urgent’选项，投此票将计为 `NoWithVeto`。*

### 法定人数

法定人数被定义为对提案投票的最低投票权百分比，以使结果有效。

在治理模块的初始版本中，协议不会强制执行法定人数。参与性通过继承和验证者因未投票而受到的惩罚来确保。

### 阈值

阈值定义为提案被接受所需的 `Yes` 票数与 `No` 票数的最小比例。

初始阈值设置为 50%，如果超过 1/3 的票（不包括 `Abstain` 票）为 `NoWithVeto` 票，提案可以被否决。这意味着提案在投票期结束时，如果 `Yes` 票数与 `No` 票数的比例超过 50%，且 `NoWithVeto` 票数少于总票数的 1/3（不包括 `Abstain` 票），则提案被接受。

`Urgent` 提案也遵循上述阈值，除了有一个可以加速接受提案的条件。即，如果 `Yes` 票数与 `InitTotalVotingPower` 的比例超过 2/3，`UrgentProposal` 将立即被接受，即使投票期尚未结束。`InitTotalVotingPower` 是投票开始时所有绑定 Atom 持有者的总投票权。

### 继承

如果委托人不投票，它将继承其验证者的投票。

- 如果委托人在其验证者之前投票，它不会继承验证者的投票。
- 如果委托人在其验证者之后投票，它将用自己的投票覆盖验证者的投票。如果提案是 `Urgent` 提案，可能在委托人有机会反应并覆盖其验证者的投票之前，投票已经结束。这不是问题，因为 `Urgent` 提案需要超过 2/3 的总投票权才能在投票期结束前通过。如果超过 2/3 的验证者合谋，他们无论如何都可以审查委托人的投票。

### 验证者未投票的惩罚

为了确保结果具有合法性，验证者必须对所有提案进行投票。投票是验证者的职责之一，未能履行将导致罚款。

如果验证者的地址不在已投票地址列表中，且投票已结束（即 `MinDeposit` 已达到且 `Voting period` 已结束），则该验证者将自动被部分削减 `GovernancePenalty`。

*注意：需要定义 `GovernancePenalty` 的值*

**例外**：如果提案是 `Urgent` 提案，并且通过了 `Yes` 票数与 `InitTotalVotingPower` 的比例超过 2/3 的特殊条件，验证者因未投票而不能被惩罚。这是因为一旦比例超过 2/3，提案将立即关闭，使得一些验证者无法投票。

### 治理密钥和治理地址

验证者可以使用一个额外的槽位来指定 `Governance PubKey`。默认情况下，验证者的 `Governance PubKey` 将与其主公钥相同。验证者可以通过发送由其主公钥签名的 `Change Governance PubKey` 交易来更改此 `Governance PubKey`。从那时起，他们可以使用与 `Governance PubKey` 关联的 `Governance PrivKey` 签署投票。`Governance PubKey` 可以随时更改。

## 软件升级

软件升级是指通过 `SoftwareUpgradeProposal` 提案进行的软件版本更新。软件升级提案必须通过特定的投票和信号流程来确保网络的一致性和稳定性。

### 信号

当一个 `SoftwareUpgradeProposal` 提案被接受后，验证者需要通过发送信号交易表明他们已经准备好切换到新版本。这个信号是通过验证者发送一个特定的交易来完成的，表示他们的软件已经升级并且他们已经准备好在网络上切换。

### 切换

一旦超过 2/3 的验证者发出了准备切换的信号，网络将自动进行版本切换。这个过程确保了网络在大多数验证者已经准备好的情况下才会进行版本升级，从而避免了网络的不稳定和分裂。

---

这份文档提供了治理模块的高级架构，包括提案提交、投票过程、继承机制以及验证者未投票的惩罚措施。同时，详细描述了软件升级的流程，确保网络的一致性和稳定性。