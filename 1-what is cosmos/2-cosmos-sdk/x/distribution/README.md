x/distribution
概述
这种简单的分发机制描述了一种在验证者和委托人之间 passively 分配奖励的功能方法。请注意，这种机制并不像主动的奖励分发机制那样精确地分配资金，因此将来会进行升级。

该机制的操作如下。收集到的奖励被全局汇总，并被 passively 分配给验证者和委托人。每个验证者有机会在代表委托人收集的奖励上收取佣金。费用直接收集到全局奖励池和验证者提议者奖励池中。由于懒惰计算的性质，每当影响奖励分发速率的参数变化时，也必须进行奖励的提取。

在提取时，必须提取其所享有的最大金额，使池中不留余额。
在保证金、解除保证金或将令牌重新委托给现有帐户时，必须进行奖励的全额提取（因为懒惰记账规则发生变化）。
当验证者选择更改奖励上的佣金时，必须同时提取所有累积的佣金奖励。
上述情况在 hooks.md 中有详细说明。

此处概述的分发机制用于在验证者和相关委托人之间惰性地分配以下奖励：

多令牌费用以社交方式分布
通货膨胀的质押资产
验证者佣金，所有由其委托人质押的资产所获得的奖励
费用在全局池内汇集。使用的机制允许验证者和委托人独立且懒惰地提取其奖励。

缺点
作为懒惰计算的一部分，每个委托人都持有与每个验证者特定的累积项，用于估算他们在费用池中持有的令牌的大致公平份额。

entitlement = delegator-accumulation / all-delegators-accumulation
在每个块中有恒定且相等的收入奖励令牌的情况下，这种分发机制将等同于主动分发（每个块单独分发给所有委托人）。然而，这是不现实的，因此根据收入奖励令牌的波动以及其他委托人的奖励提取时间，将发生与主动分发的偏差。

如果您了解到即将大幅增加的收入奖励，您将被激励在此事件之后再提取奖励，从而增加您现有累积的价值。参见＃2764以获取更多详细信息。

对于质押的影响
在 BPoS 内，同时允许对 Atom-provisions 收取佣金并自动质押（直接分配给验证者质押的令牌）是有问题的。从根本上说，这两种机制是互斥的。如果同时将佣金和自动质押机制应用于质押令牌，则验证者和其委托人之间的质押令牌分配将随每个块而变化。因此，这需要为每个委托记录每个块进行计算，这被认为是计算昂贵的。

因此，我们只能有 Atom 佣金和未质押的原子津贴，或者无 Atom 佣金的质押原子津贴，并且我们选择实施前者。希望重新绑定其津贴的利益相关者可以选择设置脚本以定期提取和重新绑定奖励。

内容
概念
状态
验证者分配
委托分配
参数
BeginBlock
消息
钩子
事件
参数
客户端
CLI
gRPC
概念
在权益证明（PoS）区块链中，通过交易费用获得的奖励会支付给验证者。费用分配模块将奖励按投票权比例公平分配给所有绑定的验证者的委托者。

奖励按周期计算。每当验证者的委托发生变化时（例如，当验证者接收新的委托），就可以计算单个验证者的奖励，方法是取委托开始前的总奖励减去当前总奖励。了解更多信息，请参阅 F1 Fee Distribution paper。

当验证者被删除或验证者请求提取时，验证者会获得佣金。佣金在每个 BeginBlock 操作期间计算并递增，以更新累积的费用金额。

委托者在撤销委托或请求提取奖励时分配奖励。在分配奖励之前，应用当前委托期间内所有对验证者的削减。

F1 分发中，委托者提取其奖励的方式是在撤销委托时计算的。这种计算必须读取他们委托结束时的奖励总和的条款，并读取最终为撤销而创建的期间。

另外，由于削减会改变委托者可能拥有的令牌数量（但我们只在委托者不再委托时才懒惰计算），因此我们必须在他们委托时之间发生的削减之前/后的分开期间内计算奖励。因此，像委托一样，削减引用了委托者委托时结束的期间。

因此，所有不再被任何委托或削减引用的历史奖励记录可以安全地删除，因为它们永远不会被读取（未来的委托和未来的削减将始终参考未来期间）。这通过追踪每个历史奖励存储条目的 ReferenceCount 来实现。每次创建可能需要引用历史记录的新对象（委托或削减）时，都会递增引用计数。每当删除以前需要引用历史记录的一个对象时，就会递减引用计数。如果引用计数为零，则删除历史记录。

状态
FeePool
FeePool 用于存储十进制奖励，以允许从通货膨胀等操作中接收硬币的分数。

一旦这些奖励足够大，它们将作为 sdk.Coins 发送到社区池。

FeePool: 0x00 -> ProtocolBuffer(FeePool)
// 含有小数的硬币
type DecCoins []DecCoin

type DecCoin struct {
Amount math.LegacyDec
Denom  string
}
验证者分配信息
与相关验证者的验证者分配信息在每次以下情况更新：

更新委托给验证者的金额，
任何委托人从验证者处撤回奖励，或者
验证者提取其佣金。
ValidatorDistInfo: 0x02 | ValOperatorAddrLen (1 byte) | ValOperatorAddr -> ProtocolBuffer(validatorDistribution)
type ValidatorDistInfo struct {
OperatorAddress     sdk.AccAddress
SelfBondRewards     sdkmath.DecCoins
ValidatorCommission

sdkmath.DecCoins
Amount              sdkmath.DecCoin
Tokens              sdkmath.DecCoins
}
委托分配
任何委托人的委托分配信息是在每次委托在每个提交阶段调用时更新的，参见 F1-部分主体讨论：

任何委托在验证者处提取奖励时需要撤销。
委托发生在验证者处。
当委托者可以委托之后进行时，他们会返回根据他们先前持有的标准结构的经济价值的数字。
参数